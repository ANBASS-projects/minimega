## disk create qcow2 foo.qcow2 512M
## disk create qcow2 bar.qcow2 512M

## # no interface or cache mode specified
## vm config disk foo.qcow2

## vm config snapshot true
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=unsafe -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=unsafe -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## vm config snapshot false
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## # interface specified, no cache mode specified
## vm config disk foo.qcow2,virtio

## vm config snapshot true
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=unsafe -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=unsafe -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## vm config snapshot false
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## # no interface specified, cache mode specified
## vm config disk foo.qcow2,writeback

## vm config snapshot true
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## vm config snapshot false
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=writeback -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## # both interface and cache mode specified, 
## vm config disk foo.qcow2,virtio,none
## vm config snapshot true
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=none -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=none -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## vm config snapshot false
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=none -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=none -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## # ahci interface
## vm config disk foo.qcow2,ahci,none
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -device ahci,id=ahci -device ide-drive,drive=ahci-drive-0,bus=ahci.0 -drive id=ahci-drive-0,file=/tmp/minimega/files/foo.qcow2,media=disk,if=none,cache=none -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -device ahci,id=ahci -device ide-drive,drive=ahci-drive-0,bus=ahci.0 -drive id=ahci-drive-0,file=/tmp/minimega/files/foo.qcow2,media=disk,if=none,cache=none -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## # multiple disks, mixed ahci/not
## vm config disk foo.qcow2,ide,none foo.qcow2,ahci,writeback foo.qcow2,virtio,writeback foo.qcow2,ahci,directsync
## vm config qemu-override
id	match	replacement

Before overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=none -device ahci,id=ahci -device ide-drive,drive=ahci-drive-0,bus=ahci.0 -drive id=ahci-drive-0,file=/tmp/minimega/files/foo.qcow2,media=disk,if=none,cache=writeback -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=writeback -device ide-drive,drive=ahci-drive-1,bus=ahci.1 -drive id=ahci-drive-1,file=/tmp/minimega/files/foo.qcow2,media=disk,if=none,cache=directsync -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

After overrides:
-name 0 -m 2048 -nographic -vnc unix:vnc -smp 1 -qmp unix:qmp,server -vga std -rtc clock=vm,base=utc -usb -device usb-ehci,id=ehci -device usb-tablet,bus=usb-bus.0 -pidfile qemu.pid -k en-us -cpu host -net none -S -drive media=cdrom -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=ide,cache=none -device ahci,id=ahci -device ide-drive,drive=ahci-drive-0,bus=ahci.0 -drive id=ahci-drive-0,file=/tmp/minimega/files/foo.qcow2,media=disk,if=none,cache=writeback -drive file=/tmp/minimega/files/foo.qcow2,media=disk,if=virtio,cache=writeback -device ide-drive,drive=ahci-drive-1,bus=ahci.1 -drive id=ahci-drive-1,file=/tmp/minimega/files/foo.qcow2,media=disk,if=none,cache=directsync -device pci-bridge,id=pci.1,chassis_nr=1 -device virtio-serial-pci,id=virtio-serial0,bus=pci.1,addr=0x1 -chardev socket,id=charvserialCC,path=cc,server,nowait -device virtserialport,bus=virtio-serial0.0,chardev=charvserialCC,id=charvserialCC,name=cc -uuid

## # launching
## clear vm config

## vm config snapshot true
## vm config disk foo.qcow2
## vm launch kvm foo1
## .column name,state,snapshot,disk vm info
name | state    | snapshot | disk
foo1 | BUILDING | true     | N/A

## vm config disk bar.qcow2
## vm launch kvm bar1
## .column name,state,snapshot,disk vm info
name | state    | snapshot | disk
bar1 | BUILDING | true     | N/A
foo1 | BUILDING | true     | N/A

## vm config clone foo1
## vm launch kvm foo2
## .column name,state,snapshot,disk vm info
name | state    | snapshot | disk
bar1 | BUILDING | true     | N/A
foo1 | BUILDING | true     | N/A
foo2 | BUILDING | true     | N/A

## # should fail
## vm config snapshot false
## vm launch kvm foo3
## .column name,state,snapshot,disk vm info
name | state    | snapshot | disk
bar1 | BUILDING | true     | N/A
foo1 | BUILDING | true     | N/A
foo2 | BUILDING | true     | N/A

## # should work
## vm config clone bar1
## vm launch kvm bar2
## .column name,state,snapshot,disk vm info
name | state    | snapshot | disk
bar1 | BUILDING | true     | N/A
bar2 | BUILDING | true     | N/A
foo1 | BUILDING | true     | N/A
foo2 | BUILDING | true     | N/A

## # should also work
## vm config clone foo1
## vm config snapshot false
## vm kill foo1
## vm kill foo2
## vm flush
## vm launch kvm foo3
## .column name,state,snapshot,disk vm info
name | state    | snapshot | disk
bar1 | BUILDING | true     | N/A
bar2 | BUILDING | true     | N/A
foo3 | BUILDING | false    | N/A
